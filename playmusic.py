import ev3dev.ev3 as ev3
import time
import sys
import threading
from ev3dev2.sound import Sound


def BGM():
    while 1:
        if ts.value()==1:
            my_sound.tone([(0,2,0)],play_type=0)
            my_sound.speak("Goal")
            sys.exit()
        my_sound.tone([(493.883,187.5*s,0),(369.994,187.5*s,0),(493.883,375*s,0),(493.883,187.5*s,0),(391.995,187.5*s,0),(493.883,375*s,0),(493.883,187.5*s,0),(246.942,187.5*s,0),(311.127,187.5*s,0),(369.994,187.5*s,0),(493.883,187.5*s,562.5*s),(659.255,187.5*s,187.5*s),(329.628,187.5*s,0),(369.994,187.5*s,0),(391.995,187.5*s,187.5*s),(493.883,187.5*s,187.5*s),(523.251,187.5*s,187.5*s),(659.255,187.5*s,187.5*s),(493.883,750*s,0),(440,93.75*s,0),(220,93.75*s,0),(329.628,93.75*s,0),(369.994,93.75*s,0),(523.251,187.5*s,187.5*s),(391.995,93.75*s,0),(195.998,93.75*s,0),(329.628,93.75*s,0),(369.994,93.75*s,0),(493.883,187.5*s,187.5*s),(369.994,93.75*s,0),(184.997,93.75*s,0),(311.127,93.75*s,0),(369.994,93.75*s,0),(493.883,187.5*s,187.5*s),(391.995,187.5*s,0),(369.994,187.5*s,0),(329.628,375*s,0),(659.255,187.5*s,187.5*s),(329.628,187.5*s,0),(369.994,187.5*s,0),(391.995,187.5*s,187.5*s),(493.883,187.5*s,187.5*s),(523.251,187.5*s,187.5*s),(659.255,187.5*s,187.5*s),(493.883,750*s,0),(493.883,187.5*s,0),(466.164,187.5*s,0),(493.883,187.5*s,0),(554.365,187.5*s,0),(587.330,187.5*s,0),(554.365,187.5*s,0),(587.330,187.5*s,0),(659.255,187.5*s,0),(739.989,187.5*s,187.5*s),(554.365,187.5*s,0),(739.989,187.5*s,0),(493.883,375*s,0)], play_type=0)

my_sound = Sound()
ts = ev3.TouchSensor('in1')     #タッチセンサを有効化
ir = ev3.InfraredSensor('in3')  #赤外線センサを有効化
ir.mode='IR-PROX'

s = 1

thread1 = threading.Thread(target=BGM)
thread1.setDaemon(True)
thread1.start()

previous_time=time.time()
while 1
    infrared = ir.value()
    
    print(infrared)
    if infrared<70:
        current_time=time.time()
        if current_time-previous_time > 1.0:
            s = s*0.8
            previous_time=current_time
    if ts.value() == 1:
        thread1.join()
        break
